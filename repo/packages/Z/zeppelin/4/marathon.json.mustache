{
    "id": "/zeppelin",
    "container": {
        "type": "DOCKER",
        "docker": {
            "image": "{{resource.assets.container.docker.zeppelin}}",
            "network": "HOST"
        },
        "volumes": [
            {
                "containerPath": "notebooks",
                "persistent": {
                    "size": 100
                },
                "mode": "RW"
            }
        ]
    },
    "residency": {
        "taskLostBehavior": "WAIT_FOREVER"
    },
    "upgradeStrategy": {
        "minimumHealthCapacity": 0,
        "maximumOverCapacity": 0
    },
    "healthChecks": [{
        "protocol": "TCP",
        "gracePeriodSeconds": 300,
        "intervalSeconds": 60,
        "portIndex": 0,
        "timeoutSeconds": 15,
        "maxConsecutiveFailures": 3
    }],
    "labels": {
        "DCOS_SERVICE_NAME": "{{service.name}}",
        "DCOS_SERVICE_SCHEME": "http",
        "DCOS_SERVICE_PORT_INDEX": "0"
    },
    "env": {
        "SPARK_APP_NAME": "Zeppelin",
        "SPARK_SUBMIT_OPTIONS": "--executor-memory {{spark.executor_memory}} --total-executor-cores {{spark.cores_max}} --conf spark.mesos.coarse=true --conf spark.mesos.executor.docker.image={{#spark.executor_docker_image}}{{spark.executor_docker_image}}{{/spark.executor_docker_image}}{{^spark.executor_docker_image}}{{resource.assets.container.docker.spark}}{{/spark.executor_docker_image}} --conf spark.mesos.executor.home=/opt/spark/dist",
        "ZEPPELIN_SPARK_USEHIVECONTEXT": "false",
        "ZEPPELIN_NOTEBOOK_DIR": "/mnt/mesos/sandbox/notebooks"
    },
    "cmd": "sed -i \"s#<value>8080</value>#<value>$PORT0</value>#\" conf/zeppelin-site.xml && export SPARK_HOME=$(find ${MESOS_SANDBOX}/ -type d -name 'spark-*') && cp -f ${MESOS_SANDBOX}/hdfs-site.xml ${MESOS_SANDBOX}/core-site.xml /etc/hadoop/ && bin/zeppelin.sh start",
    "cpus": 1,
    "mem": 2048.0,
    "fetch": [
        {"uri": "{{#spark.uri}}{{spark.uri}}{{/spark.uri}}{{^spark.uri}}{{resource.assets.uris.spark}}{{/spark.uri}}", "cache": true},
        {"uri": "{{hdfs.config-url}}/hdfs-site.xml"},
        {"uri": "{{hdfs.config-url}}/core-site.xml"}
    ]
}
